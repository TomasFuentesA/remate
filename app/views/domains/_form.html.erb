 <script>
  $(document).ready(function() {
    $('select#domain_notario_id').select2({
      theme: "bootstrap",
      width: "100%"
    });
    $('select#vendedor').select2({
      theme: "bootstrap",
      width: "100%"
    });
  });

  var global_list = ''
  var flag = false
  function get_tipo(params) {
    var list = ''  
    if (params.value != "Creacion de empresa"){
      x = 1
      <% PersonaMember.order(:type_member).each do |personam| %>
        var l = <%= params[:legal_persona_id] %>
        var id = <%= personam.legal_persona_id %>
        if (l == id) { 
          <% if personam.type_member == "Legal" %>
            <% LegalPersona.order(:id).each do |legalp| %>
              <% if legalp.id == personam.persona_id%>
                list += '<option value= <%= legalp.id%>L> <%= legalp.name%> </option>'
              <%end%> 
            <%end%>   
          <%else%>
            <% Persona.order(:id).each do |persona| %>
              <%if persona.id == personam.persona_id%>
                list += '<option value= <%= persona.id%>N> <%= persona.name%> </option>'
              <%end%>
            <%end%>     
          <%end%>
        }
      <%end%>
      
      $('.vendedor').html(list);
      $('#prueba').html('<% x = 1%>');
      $('#venta1').show();
      $('#venta2').show();
      $('#creacion').hide();        
    } else {
      x = 0
      <%Persona.order(:name).each do |persona| %>
        list += '<option value= <%= persona.id%>N> <%= persona.name%> </option>'
      <%end%>
      <%LegalPersona.order(:name).each do |legalp| %>
        list += '<option value= <%= legalp.id%>L> <%= legalp.name%> </option>'
      <%end%>
      global_list = list
      $('.vendedor').html(list);
      $('#venta1').hide();
      $('#venta2').hide();
      $('#creacion').show();
    }
  }
</script>
<script>
  function percentage_dom(params) {
    <% @legal = LegalPersona.find(params[:legal_persona_id]) %>
    var y =  <%= @legal.acciones%>
    var x = ((params.value * 100)/y).toFixed(2)
    document.getElementById('domain_percentage').value = x.toString();
  }
</script>

<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<br>
<div class="container-fluid" id="wrapper" >
<%= form_for [@domainable, @domain] do |form| %>
<% if @domain.errors.any? %>
  <div class="error_messages">
    <h2>Please correct the following errors.</h2>
    <ul>
    <% @domain.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
<% end %>
<div class="form-group">
    <div class= "card text-center bg-ligth mb-6">
      <div class= "card-header">
        <% @legal_persona = LegalPersona.find(params[:legal_persona_id])%>
        <h1>Nueva escritura de <%= @legal_persona.name %></h1>
      </div>
      <div class= "card-body">
        <p class= "card-text">
          <div class= "form-row">
            
            <div class="col">
              <%= form.label :notario_id, "Notario: " %>
              <%= form.select :notario_id , options_for_select(LegalPersona.where(notario: "Si").collect{ |c| [c.name,c.id]}), {include_blank: "Seleccione"} ,class:"custom-select mr-sm-2", required: true%>
            </div>
          </div>
          <div class="form-row">
            <div class= "col">
              <%= form.label :type_modality, "Modalidad:" %>
              <%= form.select :type_modality, options_for_select([["Creacion de empresa", "Creacion de empresa"], ["Modificacion de empresa", "Modificacion de empresa"], ["Compra y Venta de acciones","Compra y Venta de acciones"]]),{include_blank: "Seleccione"} ,class:"custom-select mr-sm-2", onchange: "get_tipo(this)" %>
            </div>

            <div class= "col">
              <%= form.label :date_posetion, "Fecha de posesion:" %>
              <%= form.text_field :date_posetion,  data:{provide:'datepicker',date_format: "dd-mm-yyyy"},autocomplete: "off", class: "form-control"  %>
            </div>

            <div class= "col">
              <%= form.label :valor, "Valor:" %>
              <%= form.text_field :valor, class: "form-control" %>
            </div>

          </div>
          <div id= "creacion" class="form-row">
            <div id="education_fields">                     
            </div>
            <div class="col-sm-3 nopadding">
              <div class="form-group">
                <select class="vendedor form-control" id="vendedor" name="vendedor[]" value="" placeholder="Vendedor">
              </div>
            </div>
            <div class="col-sm-3 nopadding">
              <div class="form-group">
                <input type="text" class="form-control" id="price" name="price[]" value="" placeholder="Precio" oninput="percentage_dom(this)" >
              </div>
            </div>
            <div class="col-sm-3 nopadding">
              <div class="form-group">
                <input type="text" class="form-control" id="percentage" name="percentage[]" value="" placeholder="Porcentaje">
              </div>
            </div>

            <div class="col-sm-3 nopadding">
              <div class="form-group">
                <div class="input-group">
                  <div class="input-group-btn">
                    <button class="btn btn-success" type="button"  onclick="education_fields(global_list);"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="clear"></div>             
            </div>
          </div>
          <div id= "prueba">
            <% x = 0 %>
            <% if x == 1 %>
              <%= render partial: 'formventa' %>
            <%end%>
          </div>            
        </p>  

        <div class="form-row">
          <div class="form-group">
            <%= form.submit "Guardar", class: "btn btn-primary btn-lg btn-block" %>
          </div>
        </div>
      </div>
    </div>  
  </div>
<% end %>
</div>

